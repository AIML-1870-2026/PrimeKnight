<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Readable Explorer</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: #1a1a1a;
      color: #e0e0e0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem 1rem;
      gap: 2rem;
    }

    .header-row {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    h1 {
      font-size: 1.5rem;
      font-weight: 600;
      letter-spacing: 0.05em;
      color: #fff;
    }

    .reset-btn {
      background: none;
      border: 1px solid #444;
      border-radius: 6px;
      color: #888;
      font-size: 0.75rem;
      font-family: inherit;
      padding: 0.3rem 0.75rem;
      cursor: pointer;
      transition: border-color 0.1s, color 0.1s;
    }

    .reset-btn:hover { border-color: #666; color: #ccc; }

    .layout {
      display: grid;
      grid-template-columns: 320px 1fr;
      gap: 1.5rem;
      width: 100%;
      max-width: 960px;
    }

    .controls-panel {
      display: flex;
      flex-direction: column;
      gap: 1.25rem;
    }

    /* ── Cards ── */
    .card {
      background: #242424;
      border: 1px solid #333;
      border-radius: 10px;
      padding: 1rem 1.25rem;
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
      background: none;
      border: none;
      padding: 0;
      cursor: pointer;
      color: inherit;
      font: inherit;
    }

    .card-title {
      font-size: 0.75rem;
      font-weight: 600;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: #bbb;
    }

    .card-chevron {
      color: #555;
      flex-shrink: 0;
      transition: transform 0.2s ease, color 0.1s;
    }

    .card-header:hover .card-chevron { color: #999; }
    .card.collapsed .card-chevron { transform: rotate(-90deg); }

    .card-body {
      display: grid;
      grid-template-rows: 1fr;
      transition: grid-template-rows 0.2s ease;
      overflow: hidden;
    }

    .card.collapsed .card-body { grid-template-rows: 0fr; }
    .card-body-inner { min-height: 0; padding-top: 0.85rem; }

    /* ── RGB sliders ── */
    .channel-row {
      display: grid;
      grid-template-columns: 14px 1fr 52px;
      align-items: center;
      gap: 0.6rem;
      margin-bottom: 0.55rem;
    }

    .channel-row:last-child { margin-bottom: 0; }

    .channel-label {
      font-size: 0.8rem;
      font-weight: 700;
      color: #ccc;
    }

    input[type="range"] {
      -webkit-appearance: none;
      appearance: none;
      width: 100%;
      height: 4px;
      border-radius: 2px;
      background: #444;
      outline: none;
      cursor: pointer;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: #fff;
      cursor: pointer;
      border: 2px solid #666;
    }

    input[type="number"] {
      width: 100%;
      background: #1a1a1a;
      border: 1px solid #444;
      border-radius: 5px;
      color: #f0f0f0;
      font-size: 0.85rem;
      font-family: inherit;
      padding: 0.25rem 0.35rem;
      text-align: center;
      outline: none;
    }

    input[type="number"]:focus { border-color: #666; }

    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; }

    /* ── Color swatch + hex + picker ── */
    .color-swatch {
      width: 100%;
      height: 20px;
      border-radius: 5px;
      margin-top: 0.75rem;
      border: 1px solid #444;
    }

    .color-input-row {
      display: flex;
      gap: 0.45rem;
      margin-top: 0.5rem;
      align-items: center;
    }

    .hex-input {
      flex: 1;
      background: #1a1a1a;
      border: 1px solid #444;
      border-radius: 5px;
      color: #f0f0f0;
      font-size: 0.8rem;
      font-family: 'Courier New', monospace;
      padding: 0.25rem 0.5rem;
      outline: none;
    }

    .hex-input:focus { border-color: #666; }

    .native-picker {
      -webkit-appearance: none;
      appearance: none;
      width: 34px;
      height: 28px;
      border: 1px solid #444;
      border-radius: 5px;
      cursor: pointer;
      background: none;
      padding: 2px;
      flex-shrink: 0;
    }

    .native-picker::-webkit-color-swatch-wrapper { padding: 0; }
    .native-picker::-webkit-color-swatch { border: none; border-radius: 3px; }

    /* ── Font selector ── */
    .font-select {
      width: 100%;
      background: #1a1a1a;
      border: 1px solid #444;
      border-radius: 5px;
      color: #f0f0f0;
      font-size: 0.85rem;
      font-family: inherit;
      padding: 0.35rem 0.5rem;
      outline: none;
      cursor: pointer;
    }

    .font-select:focus { border-color: #666; }

    /* ── Right panel ── */
    .right-panel {
      display: flex;
      flex-direction: column;
      gap: 1.25rem;
    }

    .display-hint {
      font-size: 0.65rem;
      color: #555;
      letter-spacing: 0.05em;
      margin-bottom: -0.5rem;
    }

    .display-area {
      flex: 1;
      border-radius: 10px;
      padding: 2rem;
      border: 1px solid #444;
      min-height: 200px;
      transition: background-color 0.05s, color 0.05s;
      line-height: 1.7;
      outline: none;
    }

    .display-area:focus { border-color: #666; }

    /* ── Stats ── */
    .stats-card {
      background: #242424;
      border: 1px solid #333;
      border-radius: 10px;
      padding: 1rem 1.25rem;
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 1rem;
    }

    .stat { display: flex; flex-direction: column; gap: 0.3rem; }

    .stat-label {
      font-size: 0.7rem;
      font-weight: 600;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: #aaa;
    }

    .stat-value {
      font-size: 1.3rem;
      font-weight: 700;
      color: #fff;
      font-variant-numeric: tabular-nums;
    }

    .stat-value.pass-aaa  { color: #4ade80; }
    .stat-value.pass-aa   { color: #a3e635; }
    .stat-value.pass-none { color: #f87171; }

    /* ── WCAG badges (2×2) ── */
    .wcag-badges {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.6rem;
      margin-top: 0.85rem;
    }

    .wcag-badge {
      display: flex;
      flex-direction: column;
      gap: 0.15rem;
      background: #1a1a1a;
      border-radius: 8px;
      padding: 0.65rem 0.85rem;
      border: 1px solid #333;
      transition: border-color 0.1s;
    }

    .wcag-badge-label {
      font-size: 0.65rem;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: #bbb;
    }

    .wcag-badge-threshold {
      font-size: 0.6rem;
      color: #888;
    }

    .wcag-badge-status {
      font-size: 0.95rem;
      font-weight: 700;
      margin-top: 0.25rem;
    }

    .wcag-badge.pass { border-color: #166534; }
    .wcag-badge.fail { border-color: #7f1d1d; }
    .wcag-badge.pass .wcag-badge-status { color: #4ade80; }
    .wcag-badge.fail  .wcag-badge-status { color: #f87171; }

    /* ── Vision simulation ── */
    .vision-options { display: flex; flex-direction: column; gap: 0.55rem; }

    .vision-option { display: flex; align-items: center; gap: 0.6rem; cursor: pointer; }

    .vision-option input[type="radio"] {
      accent-color: #aaa;
      width: 14px;
      height: 14px;
      flex-shrink: 0;
      cursor: pointer;
    }

    .vision-option-label { font-size: 0.85rem; color: #ddd; cursor: pointer; }

    .controls-locked { opacity: 0.35; pointer-events: none; }

    .lock-notice {
      font-size: 0.7rem;
      color: #888;
      margin-top: 0.75rem;
      display: none;
      font-style: italic;
    }

    .lock-notice.visible { display: block; }

    /* ── Presets ── */
    .preset-group-label {
      font-size: 0.62rem;
      font-weight: 600;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: #666;
      margin: 0.65rem 0 0.35rem;
    }

    .preset-group-label:first-child { margin-top: 0; }

    .preset-btn {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      width: 100%;
      background: none;
      border: 1px solid #2e2e2e;
      border-radius: 6px;
      padding: 0.3rem 0.5rem;
      cursor: pointer;
      text-align: left;
      transition: border-color 0.1s, background 0.1s;
      margin-bottom: 0.3rem;
    }

    .preset-btn:last-child { margin-bottom: 0; }
    .preset-btn:hover { border-color: #555; background: #2a2a2a; }

    .preset-swatch {
      flex-shrink: 0;
      width: 30px;
      height: 22px;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      font-weight: 700;
      border: 1px solid rgba(128,128,128,0.2);
    }

    .preset-name { font-size: 0.8rem; color: #ccc; flex: 1; }

    .preset-ratio {
      font-size: 0.72rem;
      color: #666;
      font-variant-numeric: tabular-nums;
      flex-shrink: 0;
    }
  </style>
</head>
<body>

  <div class="header-row">
    <h1>Readable Explorer</h1>
    <button class="reset-btn" id="reset-btn">Reset</button>
  </div>

  <div class="layout">
    <div class="controls-panel">

      <!-- Background Color -->
      <div class="card">
        <button class="card-header">
          <span class="card-title">Background Color</span>
          <svg class="card-chevron" width="12" height="12" viewBox="0 0 12 12" fill="none"><path d="M2 4L6 8L10 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>
        <div class="card-body"><div class="card-body-inner">
          <div class="channel-row">
            <span class="channel-label">R</span>
            <input type="range" min="0" max="255" value="255" id="bg-r-slider">
            <input type="number" min="0" max="255" value="255" id="bg-r-num">
          </div>
          <div class="channel-row">
            <span class="channel-label">G</span>
            <input type="range" min="0" max="255" value="255" id="bg-g-slider">
            <input type="number" min="0" max="255" value="255" id="bg-g-num">
          </div>
          <div class="channel-row">
            <span class="channel-label">B</span>
            <input type="range" min="0" max="255" value="255" id="bg-b-slider">
            <input type="number" min="0" max="255" value="255" id="bg-b-num">
          </div>
          <div class="color-swatch" id="bg-swatch"></div>
          <div class="color-input-row">
            <input type="text" class="hex-input" id="bg-hex" maxlength="7" placeholder="#ffffff" spellcheck="false">
            <input type="color" class="native-picker" id="bg-picker" value="#ffffff">
          </div>
        </div></div>
      </div>

      <!-- Text Color -->
      <div class="card">
        <button class="card-header">
          <span class="card-title">Text Color</span>
          <svg class="card-chevron" width="12" height="12" viewBox="0 0 12 12" fill="none"><path d="M2 4L6 8L10 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>
        <div class="card-body"><div class="card-body-inner">
          <div class="channel-row">
            <span class="channel-label">R</span>
            <input type="range" min="0" max="255" value="0" id="fg-r-slider">
            <input type="number" min="0" max="255" value="0" id="fg-r-num">
          </div>
          <div class="channel-row">
            <span class="channel-label">G</span>
            <input type="range" min="0" max="255" value="0" id="fg-g-slider">
            <input type="number" min="0" max="255" value="0" id="fg-g-num">
          </div>
          <div class="channel-row">
            <span class="channel-label">B</span>
            <input type="range" min="0" max="255" value="0" id="fg-b-slider">
            <input type="number" min="0" max="255" value="0" id="fg-b-num">
          </div>
          <div class="color-swatch" id="fg-swatch"></div>
          <div class="color-input-row">
            <input type="text" class="hex-input" id="fg-hex" maxlength="7" placeholder="#000000" spellcheck="false">
            <input type="color" class="native-picker" id="fg-picker" value="#000000">
          </div>
        </div></div>
      </div>

      <!-- Font Family -->
      <div class="card">
        <button class="card-header">
          <span class="card-title">Font Family</span>
          <svg class="card-chevron" width="12" height="12" viewBox="0 0 12 12" fill="none"><path d="M2 4L6 8L10 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>
        <div class="card-body"><div class="card-body-inner">
          <select id="font-select" class="font-select">
            <option value="system-ui, -apple-system, sans-serif">System UI</option>
            <option value="Georgia, 'Times New Roman', serif">Georgia (Serif)</option>
            <option value="'Times New Roman', Times, serif">Times New Roman</option>
            <option value="Arial, Helvetica, sans-serif">Arial</option>
            <option value="'Trebuchet MS', sans-serif">Trebuchet MS</option>
            <option value="'Courier New', Courier, monospace">Courier New (Mono)</option>
          </select>
        </div></div>
      </div>

      <!-- Font Size -->
      <div class="card">
        <button class="card-header">
          <span class="card-title">Font Size</span>
          <svg class="card-chevron" width="12" height="12" viewBox="0 0 12 12" fill="none"><path d="M2 4L6 8L10 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>
        <div class="card-body"><div class="card-body-inner">
          <div class="channel-row">
            <span class="channel-label">px</span>
            <input type="range" min="8" max="72" value="18" id="size-slider">
            <input type="number" min="8" max="72" value="18" id="size-num">
          </div>
        </div></div>
      </div>

      <!-- Vision Simulation -->
      <div class="card">
        <button class="card-header">
          <span class="card-title">Color Vision Simulation</span>
          <svg class="card-chevron" width="12" height="12" viewBox="0 0 12 12" fill="none"><path d="M2 4L6 8L10 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>
        <div class="card-body"><div class="card-body-inner">
          <div class="vision-options">
            <label class="vision-option">
              <input type="radio" name="vision" value="normal" checked>
              <span class="vision-option-label">Normal Vision</span>
            </label>
            <label class="vision-option">
              <input type="radio" name="vision" value="protanopia">
              <span class="vision-option-label">Protanopia (red-blind)</span>
            </label>
            <label class="vision-option">
              <input type="radio" name="vision" value="deuteranopia">
              <span class="vision-option-label">Deuteranopia (green-blind)</span>
            </label>
            <label class="vision-option">
              <input type="radio" name="vision" value="tritanopia">
              <span class="vision-option-label">Tritanopia (blue-blind)</span>
            </label>
            <label class="vision-option">
              <input type="radio" name="vision" value="monochromacy">
              <span class="vision-option-label">Monochromacy (no color)</span>
            </label>
          </div>
          <p class="lock-notice" id="lock-notice">Color controls are locked during simulation</p>
        </div></div>
      </div>

      <!-- Presets -->
      <div class="card">
        <button class="card-header">
          <span class="card-title">Presets</span>
          <svg class="card-chevron" width="12" height="12" viewBox="0 0 12 12" fill="none"><path d="M2 4L6 8L10 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>
        <div class="card-body"><div class="card-body-inner">
          <div id="preset-list"></div>
        </div></div>
      </div>

    </div>

    <div class="right-panel">

      <p class="display-hint">Preview — click to edit text</p>

      <!-- Text Display Area -->
      <div class="display-area" id="display" contenteditable="true" spellcheck="false">The quick brown fox jumps over the lazy dog. Pack my box with five dozen liquor jugs. How vexingly quick daft zebras jump! The five boxing wizards jump quickly. Sphinx of black quartz, judge my vow.</div>

      <!-- Stats -->
      <div class="stats-card">
        <div class="stat">
          <span class="stat-label">Contrast Ratio</span>
          <span class="stat-value" id="contrast-value">21.00:1</span>
        </div>
        <div class="stat">
          <span class="stat-label">BG Luminance</span>
          <span class="stat-value" id="bg-lum">1.0000</span>
        </div>
        <div class="stat">
          <span class="stat-label">FG Luminance</span>
          <span class="stat-value" id="fg-lum">0.0000</span>
        </div>
      </div>

      <!-- WCAG Compliance -->
      <div class="card">
        <div class="card-title">WCAG Compliance</div>
        <div class="wcag-badges">
          <div class="wcag-badge pass" id="wcag-aa-normal">
            <span class="wcag-badge-label">Normal AA</span>
            <span class="wcag-badge-threshold">≥ 4.5:1</span>
            <span class="wcag-badge-status" id="wcag-aa-normal-status">Pass</span>
          </div>
          <div class="wcag-badge pass" id="wcag-aa-large">
            <span class="wcag-badge-label">Large AA</span>
            <span class="wcag-badge-threshold">≥ 3:1</span>
            <span class="wcag-badge-status" id="wcag-aa-large-status">Pass</span>
          </div>
          <div class="wcag-badge pass" id="wcag-aaa-normal">
            <span class="wcag-badge-label">Normal AAA</span>
            <span class="wcag-badge-threshold">≥ 7:1</span>
            <span class="wcag-badge-status" id="wcag-aaa-normal-status">Pass</span>
          </div>
          <div class="wcag-badge pass" id="wcag-aaa-large">
            <span class="wcag-badge-label">Large AAA</span>
            <span class="wcag-badge-threshold">≥ 4.5:1</span>
            <span class="wcag-badge-status" id="wcag-aaa-large-status">Pass</span>
          </div>
        </div>
      </div>

    </div>
  </div>

  <script>
    // ── Math helpers ──────────────────────────────────────────────────────────
    function clamp(v, lo, hi) { return Math.max(lo, Math.min(hi, v)); }

    function toLinear(c) {
      const s = c / 255;
      return s <= 0.04045 ? s / 12.92 : Math.pow((s + 0.055) / 1.055, 2.4);
    }

    function luminance(r, g, b) {
      return 0.2126 * toLinear(r) + 0.7152 * toLinear(g) + 0.0722 * toLinear(b);
    }

    function contrastRatio(l1, l2) {
      const lighter = Math.max(l1, l2), darker = Math.min(l1, l2);
      return (lighter + 0.05) / (darker + 0.05);
    }

    function rgbToHex(r, g, b) {
      return '#' + [r, g, b].map(v => v.toString(16).padStart(2, '0')).join('');
    }

    function hexToRgb(hex) {
      const h = hex.replace('#', '');
      if (!/^[0-9a-fA-F]{6}$/.test(h)) return null;
      return [parseInt(h.slice(0,2),16), parseInt(h.slice(2,4),16), parseInt(h.slice(4,6),16)];
    }

    // ── State ─────────────────────────────────────────────────────────────────
    const bg = { r: 255, g: 255, b: 255 };
    const fg = { r: 0,   g: 0,   b: 0   };
    let fontSize   = 18;
    let fontFamily = 'system-ui, -apple-system, sans-serif';

    // ── Sync helpers ──────────────────────────────────────────────────────────
    function syncPair(slider, numInput, min, max, onChange) {
      slider.addEventListener('input', () => {
        const v = clamp(parseInt(slider.value, 10), min, max);
        numInput.value = v;
        onChange(v);
      });
      numInput.addEventListener('input', () => {
        const raw = parseInt(numInput.value, 10);
        if (isNaN(raw)) return;
        const v = clamp(raw, min, max);
        slider.value = v;
        onChange(v);
      });
    }

    function pushRgbToInputs(prefix, r, g, b) {
      ['r','g','b'].forEach((ch, i) => {
        const val = [r, g, b][i];
        document.getElementById(`${prefix}-${ch}-slider`).value = val;
        document.getElementById(`${prefix}-${ch}-num`).value   = val;
      });
    }

    // ── URL state ─────────────────────────────────────────────────────────────
    function pushState() {
      const params = new URLSearchParams({
        bg:   rgbToHex(bg.r, bg.g, bg.b).slice(1),
        fg:   rgbToHex(fg.r, fg.g, fg.b).slice(1),
        size: fontSize,
        font: fontFamily,
      });
      history.replaceState(null, '', '?' + params.toString());
    }

    // ── Main update ───────────────────────────────────────────────────────────
    function update() {
      const display = document.getElementById('display');
      display.style.backgroundColor = `rgb(${bg.r},${bg.g},${bg.b})`;
      display.style.color           = `rgb(${fg.r},${fg.g},${fg.b})`;
      display.style.fontSize        = fontSize + 'px';
      display.style.fontFamily      = fontFamily;

      document.getElementById('bg-swatch').style.backgroundColor = `rgb(${bg.r},${bg.g},${bg.b})`;
      document.getElementById('fg-swatch').style.backgroundColor = `rgb(${fg.r},${fg.g},${fg.b})`;

      // Hex + picker sync (skip if element is focused — user is mid-type)
      const bgHex = document.getElementById('bg-hex');
      const fgHex = document.getElementById('fg-hex');
      if (document.activeElement !== bgHex) bgHex.value = rgbToHex(bg.r, bg.g, bg.b);
      if (document.activeElement !== fgHex) fgHex.value = rgbToHex(fg.r, fg.g, fg.b);
      document.getElementById('bg-picker').value = rgbToHex(bg.r, bg.g, bg.b);
      document.getElementById('fg-picker').value = rgbToHex(fg.r, fg.g, fg.b);

      const lBg  = luminance(bg.r, bg.g, bg.b);
      const lFg  = luminance(fg.r, fg.g, fg.b);
      const ratio = contrastRatio(lBg, lFg);

      const contrastEl = document.getElementById('contrast-value');
      contrastEl.textContent = ratio.toFixed(2) + ':1';
      contrastEl.className = 'stat-value ' + (ratio >= 7 ? 'pass-aaa' : ratio >= 4.5 ? 'pass-aa' : 'pass-none');

      document.getElementById('bg-lum').textContent = lBg.toFixed(4);
      document.getElementById('fg-lum').textContent = lFg.toFixed(4);

      setWcag('wcag-aa-normal',  'wcag-aa-normal-status',  ratio >= 4.5);
      setWcag('wcag-aa-large',   'wcag-aa-large-status',   ratio >= 3);
      setWcag('wcag-aaa-normal', 'wcag-aaa-normal-status', ratio >= 7);
      setWcag('wcag-aaa-large',  'wcag-aaa-large-status',  ratio >= 4.5);

      pushState();
    }

    function setWcag(badgeId, statusId, passes) {
      const badge  = document.getElementById(badgeId);
      const status = document.getElementById(statusId);
      badge.classList.toggle('pass', passes);
      badge.classList.toggle('fail', !passes);
      status.textContent = passes ? 'Pass' : 'Fail';
    }

    // ── Apply helpers ─────────────────────────────────────────────────────────
    function applyColors(bgR, bgG, bgB, fgR, fgG, fgB) {
      [bg.r, bg.g, bg.b] = [bgR, bgG, bgB];
      [fg.r, fg.g, fg.b] = [fgR, fgG, fgB];
      pushRgbToInputs('bg', bg.r, bg.g, bg.b);
      pushRgbToInputs('fg', fg.r, fg.g, fg.b);
      update();
    }

    // ── Wire RGB sliders ──────────────────────────────────────────────────────
    syncPair(document.getElementById('bg-r-slider'), document.getElementById('bg-r-num'), 0, 255, v => { bg.r = v; update(); });
    syncPair(document.getElementById('bg-g-slider'), document.getElementById('bg-g-num'), 0, 255, v => { bg.g = v; update(); });
    syncPair(document.getElementById('bg-b-slider'), document.getElementById('bg-b-num'), 0, 255, v => { bg.b = v; update(); });
    syncPair(document.getElementById('fg-r-slider'), document.getElementById('fg-r-num'), 0, 255, v => { fg.r = v; update(); });
    syncPair(document.getElementById('fg-g-slider'), document.getElementById('fg-g-num'), 0, 255, v => { fg.g = v; update(); });
    syncPair(document.getElementById('fg-b-slider'), document.getElementById('fg-b-num'), 0, 255, v => { fg.b = v; update(); });

    // ── Wire hex inputs ───────────────────────────────────────────────────────
    function wireHex(hexId, prefix, state) {
      document.getElementById(hexId).addEventListener('input', function() {
        const rgb = hexToRgb(this.value.trim());
        if (!rgb) return;
        [state.r, state.g, state.b] = rgb;
        pushRgbToInputs(prefix, state.r, state.g, state.b);
        update();
      });
    }

    wireHex('bg-hex', 'bg', bg);
    wireHex('fg-hex', 'fg', fg);

    // ── Wire color pickers ────────────────────────────────────────────────────
    function wirePicker(pickerId, prefix, state) {
      document.getElementById(pickerId).addEventListener('input', function() {
        const rgb = hexToRgb(this.value);
        if (!rgb) return;
        [state.r, state.g, state.b] = rgb;
        pushRgbToInputs(prefix, state.r, state.g, state.b);
        update();
      });
    }

    wirePicker('bg-picker', 'bg', bg);
    wirePicker('fg-picker', 'fg', fg);

    // ── Wire font size ────────────────────────────────────────────────────────
    syncPair(document.getElementById('size-slider'), document.getElementById('size-num'), 8, 72, v => { fontSize = v; update(); });

    // ── Wire font family ──────────────────────────────────────────────────────
    document.getElementById('font-select').addEventListener('change', function() {
      fontFamily = this.value;
      update();
    });

    // ── Reset ─────────────────────────────────────────────────────────────────
    document.getElementById('reset-btn').addEventListener('click', () => {
      const normalRadio = document.querySelector('input[name="vision"][value="normal"]');
      if (!normalRadio.checked) { normalRadio.checked = true; normalRadio.dispatchEvent(new Event('change')); }
      document.getElementById('size-slider').value = 18;
      document.getElementById('size-num').value    = 18;
      fontSize = 18;
      document.getElementById('font-select').value = 'system-ui, -apple-system, sans-serif';
      fontFamily = 'system-ui, -apple-system, sans-serif';
      applyColors(255, 255, 255, 0, 0, 0);
    });

    // ── Presets ───────────────────────────────────────────────────────────────
    const PRESETS = [
      { group: 'High Contrast', label: 'Black on White',     bg: [255,255,255], fg: [0,0,0]       },
      { group: 'High Contrast', label: 'White on Black',     bg: [0,0,0],       fg: [255,255,255] },
      { group: 'High Contrast', label: 'High Contrast Dark', bg: [0,0,0],       fg: [255,255,0]   },
      { group: 'Low Contrast',  label: 'Gray on White',      bg: [255,255,255], fg: [187,187,187] },
      { group: 'Low Contrast',  label: 'Muted on Light',     bg: [240,240,245], fg: [185,190,200] },
      { group: 'Web Schemes',   label: 'GitHub Dark',        bg: [13,17,23],    fg: [230,237,243] },
      { group: 'Web Schemes',   label: 'Amber Terminal',     bg: [18,18,18],    fg: [255,176,0]   },
      { group: 'Web Schemes',   label: 'Ocean Slate',        bg: [15,23,42],    fg: [148,163,184] },
      { group: 'Web Schemes',   label: 'Warm Paper',         bg: [254,243,199], fg: [120,53,15]   },
      { group: 'Web Schemes',   label: 'Solarized Dark',     bg: [0,43,54],     fg: [131,148,150] },
      { group: 'Web Schemes',   label: 'Solarized Light',    bg: [253,246,227], fg: [101,123,131] },
      { group: 'WCAG Fail',     label: 'Red on Green',       bg: [0,128,0],     fg: [255,0,0]     },
      { group: 'WCAG Fail',     label: 'Yellow on White',    bg: [255,255,255], fg: [220,205,0]   },
      { group: 'WCAG Fail',     label: 'Blue on Purple',     bg: [102,0,153],   fg: [0,0,204]     },
    ];

    function applyPreset(p) {
      const normalRadio = document.querySelector('input[name="vision"][value="normal"]');
      if (!normalRadio.checked) { normalRadio.checked = true; normalRadio.dispatchEvent(new Event('change')); }
      applyColors(...p.bg, ...p.fg);
    }

    const presetList = document.getElementById('preset-list');
    let lastGroup = null;
    PRESETS.forEach(p => {
      if (p.group !== lastGroup) {
        const lbl = document.createElement('div');
        lbl.className = 'preset-group-label';
        lbl.textContent = p.group;
        presetList.appendChild(lbl);
        lastGroup = p.group;
      }
      const ratio = contrastRatio(luminance(...p.bg), luminance(...p.fg));
      const btn = document.createElement('button');
      btn.className = 'preset-btn';
      btn.innerHTML = `
        <span class="preset-swatch" style="background:rgb(${p.bg});color:rgb(${p.fg})">Aa</span>
        <span class="preset-name">${p.label}</span>
        <span class="preset-ratio">${ratio.toFixed(1)}:1</span>`;
      btn.addEventListener('click', () => applyPreset(p));
      presetList.appendChild(btn);
    });

    // ── Collapsible cards ─────────────────────────────────────────────────────
    document.querySelectorAll('.card-header').forEach(header => {
      header.addEventListener('click', () => header.closest('.card').classList.toggle('collapsed'));
    });

    // ── Vision simulation ─────────────────────────────────────────────────────
    const colorCards = [
      document.getElementById('bg-r-slider').closest('.card'),
      document.getElementById('fg-r-slider').closest('.card'),
    ];

    document.querySelectorAll('input[name="vision"]').forEach(radio => {
      radio.addEventListener('change', () => {
        const display = document.getElementById('display');
        const notice  = document.getElementById('lock-notice');
        if (radio.value === 'normal') {
          display.style.filter = '';
          colorCards.forEach(c => c.classList.remove('controls-locked'));
          notice.classList.remove('visible');
        } else {
          display.style.filter = `url(#filter-${radio.value})`;
          colorCards.forEach(c => c.classList.add('controls-locked'));
          notice.classList.add('visible');
        }
      });
    });

    // ── Init from URL ─────────────────────────────────────────────────────────
    (function initFromUrl() {
      const p = new URLSearchParams(location.search);
      const urlBg   = p.get('bg');
      const urlFg   = p.get('fg');
      const urlSize = p.get('size');
      const urlFont = p.get('font');

      if (urlBg) { const rgb = hexToRgb('#' + urlBg); if (rgb) { [bg.r, bg.g, bg.b] = rgb; pushRgbToInputs('bg', bg.r, bg.g, bg.b); } }
      if (urlFg) { const rgb = hexToRgb('#' + urlFg); if (rgb) { [fg.r, fg.g, fg.b] = rgb; pushRgbToInputs('fg', fg.r, fg.g, fg.b); } }
      if (urlSize) {
        const sz = clamp(parseInt(urlSize, 10), 8, 72);
        if (!isNaN(sz)) { fontSize = sz; document.getElementById('size-slider').value = sz; document.getElementById('size-num').value = sz; }
      }
      if (urlFont) {
        const sel = document.getElementById('font-select');
        for (const opt of sel.options) { if (opt.value === urlFont) { sel.value = urlFont; fontFamily = urlFont; break; } }
      }
    })();

    // ── Initial render ────────────────────────────────────────────────────────
    update();
  </script>

  <!-- Color blindness simulation filters -->
  <svg aria-hidden="true" style="position:absolute;width:0;height:0;overflow:hidden">
    <defs>
      <filter id="filter-protanopia">
        <feColorMatrix type="matrix" values="
          0.567 0.433 0     0 0
          0.558 0.442 0     0 0
          0     0.242 0.758 0 0
          0     0     0     1 0"/>
      </filter>
      <filter id="filter-deuteranopia">
        <feColorMatrix type="matrix" values="
          0.625 0.375 0   0 0
          0.7   0.3   0   0 0
          0     0.3   0.7 0 0
          0     0     0   1 0"/>
      </filter>
      <filter id="filter-tritanopia">
        <feColorMatrix type="matrix" values="
          0.95  0.05  0     0 0
          0     0.433 0.567 0 0
          0     0.475 0.525 0 0
          0     0     0     1 0"/>
      </filter>
      <filter id="filter-monochromacy">
        <feColorMatrix type="matrix" values="
          0.299 0.587 0.114 0 0
          0.299 0.587 0.114 0 0
          0.299 0.587 0.114 0 0
          0     0     0     1 0"/>
      </filter>
    </defs>
  </svg>

</body>
</html>
